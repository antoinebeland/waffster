/*! budgetviz v0.5.0 | (c) Antoine BÃ©land | GNU GPLv3 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-array"),require("d3-collection"),require("d3-selection"),require("d3-transition"),require("d3-shape"),require("d3-ease"),require("d3-scale")):"function"==typeof define&&define.amd?define(["exports","d3-array","d3-collection","d3-selection","d3-transition","d3-shape","d3-ease","d3-scale"],e):e(t.budgetviz={},t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3)}(this,function(t,e,n,i,o,r,s,a){"use strict";var u="default"in e?e.default:e;n=n&&n.hasOwnProperty("default")?n.default:n;var h,c="default"in i?i.default:i;o=o&&o.hasOwnProperty("default")?o.default:o,r=r&&r.hasOwnProperty("default")?r.default:r,s=s&&s.hasOwnProperty("default")?s.default:s,a=a&&a.hasOwnProperty("default")?a.default:a,(h=t.Orientation||(t.Orientation={})).HORIZONTAL="horizontal",h.VERTICAL="vertical";var l=function(){function e(){}return e.AVERAGE_CHAR_SIZE=7.5,e.BUDGET_ELEMENTS_ORIENTATION=t.Orientation.HORIZONTAL,e.BUDGET_SUB_ELEMENTS_SPACING=3,e.GAUGE_CONFIG={barWidth:15,height:60,interval:[-26e6,26e6],needleRadius:6,width:120},e.IS_USING_DISTINCT_COLORS=!1,e.LEVEL_CHANGE_DELAY=1e3,e.MIN_AMOUNT=5e4,e.MAX_COUNT_PER_LINE=20,e.SIDE_LENGTH=6,e.TRANSITION_DURATION=350,e.DEFAULT_POLYGONS_GROUP_CONFIG={maxCountPerLine:e.MAX_COUNT_PER_LINE,orientation:e.BUDGET_ELEMENTS_ORIENTATION,sideLength:e.SIDE_LENGTH},e}();function d(t){var e=!1;return t.children&&t.children.length>0?e=t.children.every(function(t){return d(t)}):t.amount&&!isNaN(t.amount)&&(e=!0),e&&t.name}var p,g=function(){function t(){}return t.formatAmount=function(t){var e=t/Math.pow(10,6);return Math.abs(e)>=1?e.toFixed(2).replace(".",",")+" G$":(e=t/Math.pow(10,3)).toFixed(0).replace(".",",")+" M$"},t.formatId=function(t,e){return void 0===e&&(e="-"),t.trim().toLowerCase().replace(/[^a-zA-Z ]/g,"").replace(/\s/g,e)},t}();!function(t){t.DEFICIT="deficit",t.INCOME="income",t.SPENDING="spending"}(p||(p={}));var f=function(){function t(t,e,n,i){if(void 0===e&&(e=""),this._activeLevel=0,this._level=0,i<=0)throw new RangeError("The min amount must be greater than 0.");this.id=g.formatId(t),this.name=t,this.description=e,this.type=n,this._minAmount=i}return Object.defineProperty(t.prototype,"amount",{get:function(){return this.polygonsGroup.count*this._minAmount},set:function(t){if(t<0)throw new TypeError("Invalid amount specified.");this.polygonsGroup.count=Math.ceil(t/this._minAmount)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isActive",{get:function(){return this._level===this.activeLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){for(var t=this;void 0!==t.parent;)t=t.parent;return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedAmount",{get:function(){return this.polygonsGroup.selectionCount*this._minAmount},set:function(t){t<0&&(t=0),this.selectedAmount!==t&&(t=Math.min(t,this.amount),this.polygonsGroup.selectionCount=Math.ceil(t/this._minAmount))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"temporaryAmount",{get:function(){return this.polygonsGroup.temporaryCount*this._minAmount},set:function(t){this.polygonsGroup.temporaryCount=Math.ceil(t/this._minAmount)},enumerable:!0,configurable:!0}),t}(),_=function(t,e){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function m(t,e){function n(){this.constructor=t}_(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var y,v=function(){function t(t,e,n){if(void 0===t&&(t={x:0,y:0}),void 0===e&&(e=0),void 0===n&&(n=0),e<0)throw new RangeError("Invalid width specified.");if(n<0)throw new RangeError("Invalid height specified.");this.position=t,this.width=e,this.height=n}return Object.defineProperty(t.prototype,"x",{get:function(){return this.position.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.position.y},enumerable:!0,configurable:!0}),t.prototype.isInto=function(t){return this.position.x<=t.x&&this.position.x+this.width>=t.x&&this.position.y<=t.y&&this.position.y+this.height>=t.y},t.prototype.toString=function(){return"x: "+this.position.x+" y: "+this.position.y+" width: "+this.width+" height: "+this.height},t}(),b=function(){function e(t){this._boundary=[],this._selectionCount=0,this.config=t,this._boundary=[],this._boundingBox=new v,this._translation={x:0,y:0}}return Object.defineProperty(e.prototype,"boundary",{get:function(){return this._boundary},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundingBox",{get:function(){return this._boundingBox},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"config",{get:function(){return this.getBaseConfig()},set:function(t){this.setBaseConfig(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectionCount",{get:function(){return this._selectionCount},set:function(t){if(t<0||t>this.count)throw new TypeError("The specified count is invalid");if(this._selectionCount!==t){this._selectionCount=t;for(var e=this.polygons,n=this.polygons.length-1,i=n;i>=0;--i)e[i].isSelected=n-i<t}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"translation",{get:function(){return this._translation},enumerable:!0,configurable:!0}),e.prototype.translate=function(e){this._orientation===t.Orientation.HORIZONTAL?(this._translation.x=0,this._translation.y=e):(this._translation.x=e,this._translation.y=0)},e.prototype.getBaseConfig=function(){return{maxCountPerLine:this._maxCountPerLine,orientation:this._orientation,sideLength:this._sideLength,startingPosition:this._startingPosition}},e.prototype.setBaseConfig=function(e){if(!function(e){return void 0!==e&&void 0!==e.maxCountPerLine&&!isNaN(e.maxCountPerLine)&&e.maxCountPerLine>0&&(void 0===e.orientation||Object.values(t.Orientation).includes(e.orientation))&&void 0!==e.sideLength&&!isNaN(e.sideLength)&&e.sideLength>0&&(void 0===e.startingPosition||e.startingPosition>=0&&e.startingPosition<e.maxCountPerLine)}(e))throw new TypeError("Invalid configuration specified.");this._maxCountPerLine=e.maxCountPerLine,this._orientation=e.orientation||t.Orientation.HORIZONTAL,this._sideLength=e.sideLength,this._startingPosition=e.startingPosition||0},e.prototype.updateBoundary=function(){var e=this.getBoundingBox({x:0,y:0},!1),n=this.count+this._startingPosition||1,i=Math.ceil(n/this._maxCountPerLine)>1;if(this._boundary=[],i?this._orientation===t.Orientation.HORIZONTAL?this._boundary.push({x:e.x+this._startingPosition*this._sideLength-0,y:e.y-0}):this._boundary.push({x:e.x-0,y:e.y+this._startingPosition*this._sideLength-0}):this._boundary.push({x:e.x-0,y:e.y-0}),this._boundary.push({x:e.x+e.width+0,y:e.y-0}),n%this._maxCountPerLine!=0&&i)if(this._orientation===t.Orientation.HORIZONTAL){this._boundary.push({x:e.x+e.width+0,y:e.y+e.height-this._sideLength+0});var o=n%this._maxCountPerLine*this._sideLength;this._boundary.push({x:e.x+o+0,y:e.y+e.height-this._sideLength+0}),this._boundary.push({x:e.x+o+0,y:e.y+e.height+0})}else{var r=n%this._maxCountPerLine*this._sideLength;this._boundary.push({x:e.x+e.width+0,y:e.y+r+0}),this._boundary.push({x:e.x+e.width-this._sideLength+0,y:e.y+r+0}),this._boundary.push({x:e.x+e.width-this._sideLength+0,y:e.y+e.height+0})}else this._boundary.push({x:e.x+e.width+0,y:e.y+e.height+0});this._boundary.push({x:e.x-0,y:e.y+e.height+0}),0!==this._startingPosition&&i&&(this._orientation===t.Orientation.HORIZONTAL?(this._boundary.push({x:e.x-0,y:e.y+this._sideLength-0}),this._boundary.push({x:e.x+this._startingPosition*this._sideLength-0,y:e.y+this._sideLength-0})):(this._boundary.push({x:e.x+this._sideLength-0,y:e.y-0}),this._boundary.push({x:e.x+this._sideLength-0,y:e.y+this._startingPosition*this._sideLength-0})))},e.prototype.getBoundingBox=function(e,n){void 0===n&&(n=!0);var i=this.count;n&&this.temporaryCount>0&&(i+=this.temporaryCount);var o=this._maxCountPerLine;if(this.count>0&&(this._startingPosition+i)/this._maxCountPerLine<=1){o=i;var r=this._startingPosition*this._sideLength;this._orientation===t.Orientation.HORIZONTAL?e.x+=r:e.y+=r}var s=i>0?o*this._sideLength:this._sideLength,a=i>0?Math.ceil((this._startingPosition+i)/this._maxCountPerLine)*this._sideLength:this._sideLength;return this._orientation===t.Orientation.HORIZONTAL?new v(e,s,a):new v(e,a,s)},e}();!function(t){t[t.COLLAPSED=0]="COLLAPSED",t[t.EXPANDED=1]="EXPANDED"}(y||(y={}));var x,E=function(n){function i(t,e){var i=n.call(this,t)||this;return i._children=[],i._spacing=e,i._state=y.COLLAPSED,i}return m(i,n),Object.defineProperty(i.prototype,"count",{get:function(){return this._children.reduce(function(t,e){return t+e.count},0)},set:function(t){if(this.count!==t){if(t<0)throw new RangeError("Invalid count specified.");if(0!==this.temporaryCount)throw new Error("You should not have temporary element before to set a new count.");var e=0,n=this.children,i=this.count;n.forEach(function(o){var r;r=0===i?1/n.length:o.count/i;var s=Math.round(r*t);e+=Math.abs(o.count-s),o.count=s});var o=t-i;if(n.length>0&&Math.abs(o)!==e){var r=(o>0?1:-1)*(Math.abs(o)-e);n.some(function(t){var e=t.count+r;return e<0&&(e=0),r<0&&(r+=t.count-e),t.count=e,r>=0})}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"polygons",{get:function(){return[].concat.apply([],this.children.map(function(t){return t.polygons}))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"temporaryCount",{get:function(){return this._children.reduce(function(t,e){return t+e.temporaryCount},0)},set:function(t){this.temporaryCount;if(this.temporaryCount!==t){var e=this.children;if(!(e.length<=0))if((t=Math.max(-this.count,t))>0)this.count>0?e[e.length-1].temporaryCount=t:e[0].temporaryCount=t;else{this.temporaryCount>0&&e.forEach(function(t){return t.temporaryCount=0});for(var n=t,i=e.length-1;i>=0;--i){var o=e[i];Math.abs(n)-o.count>=0?(o.temporaryCount=-o.count,n+=o.count):(o.temporaryCount=n,n=0)}}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"children",{get:function(){return this._children.sort(function(t,n){return e.descending(t.count,n.count)})},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"spacing",{get:function(){return this._spacing},set:function(t){this._spacing=t},enumerable:!0,configurable:!0}),i.prototype.reshape=function(t){void 0===t&&(t=0),this._startingPosition=t,this.update()},i.prototype.addGroup=function(t){this._children.push(t)},i.prototype.removeGroup=function(t){this._children.splice(this._children.findIndex(function(e){return e===t}),1)},i.prototype.collapse=function(){this._state=y.COLLAPSED},i.prototype.expand=function(){this._state=y.EXPANDED},i.prototype.update=function(){var e=this,n=this.children;switch(this._state){case y.COLLAPSED:var i=this._startingPosition,o=0;n.forEach(function(n,r){var s=i%e._maxCountPerLine==0||0===r?0:e._sideLength;n.translate(o-s),n.reshape(i%e._maxCountPerLine),i+=n.count,e._orientation===t.Orientation.HORIZONTAL?o+=n.boundingBox.height-s:o+=n.boundingBox.width-s});break;case y.EXPANDED:this._startingPosition=0;var r=0;n.forEach(function(n){n.translate(r),n.reshape(0),e._orientation===t.Orientation.HORIZONTAL?r+=n.boundingBox.height+e._spacing:r+=n.boundingBox.width+e._spacing})}this.updateBoundingBox()},i.prototype.updateBoundingBox=function(){var t=this.count+Math.max(0,this.temporaryCount),e={height:this._sideLength,width:this._sideLength};t>0&&this._children.forEach(function(t){var n=t.translation.y+t.boundingBox.y+t.boundingBox.height,i=t.translation.x+t.boundingBox.x+t.boundingBox.width;e.height<n&&(e.height=n),e.width<i&&(e.width=i)}),this._boundingBox.height=e.height,this._boundingBox.width=e.width,this.updateBoundary()},i}(b),w=function(t){function n(e,n,i,o,r){void 0===e&&(e=""),void 0===i&&(i=p.SPENDING),void 0===o&&(o=l.MIN_AMOUNT),void 0===r&&(r=l.DEFAULT_POLYGONS_GROUP_CONFIG);var s=t.call(this,e,n,i,o)||this;return s._children=[],s._group=new E(r,l.BUDGET_SUB_ELEMENTS_SPACING),s._hasFocus=!1,s}return m(n,t),Object.defineProperty(n.prototype,"activeLevel",{get:function(){return Math.min(this._level+1,this._activeLevel)},set:function(t){if(t<0)throw new RangeError("Invalid level specified.");this._activeLevel!==t&&(this._activeLevel=t,this._hasFocus=!1,this._group.selectionCount=0,this._children.forEach(function(e){return e.activeLevel=t}),this.level+1<=this.activeLevel?(this.level>0&&this.activeLevel>1?this.root.polygonsGroup.spacing=3*l.BUDGET_SUB_ELEMENTS_SPACING:this.polygonsGroup.spacing=l.BUDGET_SUB_ELEMENTS_SPACING,this._group.expand()):this._group.collapse())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"hasFocus",{get:function(){return this._hasFocus},set:function(t){this._hasFocus=t,this.selectedAmount=0,this.children.forEach(function(e){return e.hasFocus=t})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"level",{get:function(){return this._level},set:function(t){if(t<0)throw new RangeError("Invalid level specified.");this._level=t,this._children.forEach(function(e){return e.level=t+1})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"svgElement",{get:function(){return this._svgElement},set:function(t){if(!t)throw ReferenceError("The specified element is undefined.");this._svgElement=t;var e=t.append("g").attr("class","level-group");e.append("rect").attr("x",0).attr("y",0).attr("width",0).attr("height",0),e.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",0),this.children.forEach(function(e){e.svgElement=t.append("g")}),this._svgElement.append("polygon").attr("class","boundary boundary"+this.level)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"polygonsGroup",{get:function(){return this._group},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"children",{get:function(){return this._children.sort(function(t,n){return e.descending(t.amount,n.amount)})},enumerable:!0,configurable:!0}),n.prototype.accept=function(t){t.visitBudgetElementGroup(this)},n.prototype.addChild=function(t){t.activeLevel=this._activeLevel,t.level=this._level+1,t.parent=this,this._children.push(t),this._group.addGroup(t.polygonsGroup)},n.prototype.removeChild=function(t){this._children.splice(this._children.findIndex(function(e){return e===t}),1),t.activeLevel=0,t.level=0,t.parent=void 0},n}(f),L=function(){function t(e,n){if(n<0)throw new RangeError("The specified side length is invalid.");this._id=t._currentId++,this._position=e,this._sideLength=n,this._boundingBox=new v(this._position,this._sideLength,this._sideLength),this.update()}return Object.defineProperty(t.prototype,"boundingBox",{get:function(){return this._boundingBox},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"points",{get:function(){return this._points},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t,this._boundingBox.position.x=t.x,this._boundingBox.position.y=t.y,this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sideLength",{get:function(){return this._sideLength},set:function(t){if(t<0)throw new RangeError("The specified side length is invalid.");this._sideLength=t,this._boundingBox.height=t,this._boundingBox.width=t,this.update()},enumerable:!0,configurable:!0}),t.prototype.update=function(){var t=this,n=this._position.x+this._sideLength/2,i=this._position.y+this._sideLength/2;this._points=e.range(4).map(function(e){var o=e<2?e%2:(e+1)%2,r=Math.floor(e/2);return{x:n-(0===o?1:-1)*t._sideLength/2,y:i-(0===r?1:-1)*t._sideLength/2}})},t._currentId=0,t}(),A=function(n){function i(t,i){var o=this;if(t<0)throw new RangeError("Invalid count specified.");return(o=n.call(this,i)||this)._count=t,o._position={x:0,y:0},o._squares=e.range(o._startingPosition,o._count+o._startingPosition).map(function(t){return new L(o.getSquarePosition(t),o._sideLength)}),o._temporaryCount=0,o.updateBoundingBox(),o}return m(i,n),Object.defineProperty(i.prototype,"config",{get:function(){return n.prototype.getBaseConfig.call(this)},set:function(t){var e=this;n.prototype.setBaseConfig.call(this,t),this._squares&&(this._squares.forEach(function(t,n){t.position=e.getSquarePosition(n+e._startingPosition),t.sideLength=e._sideLength}),this.updateBoundingBox())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"count",{get:function(){return this._count},set:function(t){if(this._count!==t){if(t<0)throw new RangeError("Invalid count specified ("+t+").");if(0!==this._temporaryCount)throw new Error("You should not have temporary element before to set a new count.");this.updateCount(this._count,t),this._count=t,this.updateBoundingBox()}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"polygons",{get:function(){return this._squares},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"temporaryCount",{get:function(){return this._temporaryCount},set:function(t){var e=this;this._temporaryCount!==t&&((t=Math.max(-this._count,t))>=0?(this._temporaryCount<=0&&(this._temporaryCount=0,this._squares.forEach(function(t){return t.isTemporary=!1})),this.updateCount(this._count+this._temporaryCount,this._count+t,!0)):(this._temporaryCount>0&&this.updateCount(this._count+this._temporaryCount,this._count,!0),this._squares.forEach(function(n,i){return n.isTemporary=i>=e._count+t})),this._temporaryCount=t,this.updateBoundingBox())},enumerable:!0,configurable:!0}),i.prototype.reshape=function(t){var e=this;if(void 0===t&&(t=0),this._startingPosition!==t){if(t<0||t>=this._maxCountPerLine)throw new RangeError("Invalid starting position specified.");var n=this._startingPosition-t,i=Math.min(Math.abs(n),this._count);if(n>0){var o=this._squares.slice(0,this._squares.length-i);(r=this._squares.slice(this._squares.length-i)).forEach(function(n,i){n.position=e.getSquarePosition(i+t)}),this._squares=r.concat(o)}else{var r,s=this._squares.slice(i);(r=this._squares.slice(0,i)).forEach(function(n,i){n.position=e.getSquarePosition(i+t+s.length)}),this._squares=s.concat(r)}this._startingPosition=t,this.updateBoundingBox()}},i.prototype.getSquarePosition=function(e){var n={x:this._position.x,y:this._position.y};if(Math.floor(e/this._maxCountPerLine)>0){var i=this._sideLength*Math.floor(e/this._maxCountPerLine);this._orientation===t.Orientation.HORIZONTAL?n.y+=i:n.x+=i}var o=this._sideLength*(e%this._maxCountPerLine);return this._orientation===t.Orientation.HORIZONTAL?n.x+=o:n.y+=o,n},i.prototype.updateCount=function(t,n,i){var o=this;void 0===i&&(i=!1),this._squares=t>n?this._squares.slice(0,n):this._squares.concat(e.range(t+this._startingPosition,n+this._startingPosition).map(function(t){var e=new L(o.getSquarePosition(t),o._sideLength);return e.isTemporary=i,e}))},i.prototype.updateBoundingBox=function(){this._boundingBox=this.getBoundingBox({x:this._position.x,y:this._position.y}),this.updateBoundary()},i}(b),P=function(t){function e(e,n,i,o,r,s){void 0===e&&(e=0),void 0===n&&(n=""),void 0===i&&(i=""),void 0===o&&(o=p.SPENDING),void 0===r&&(r=l.MIN_AMOUNT),void 0===s&&(s=l.DEFAULT_POLYGONS_GROUP_CONFIG);var a=t.call(this,n,i,o,r)||this;return a._group=new A(Math.round(e/a._minAmount),s),a._hasFocus=!1,a}return m(e,t),Object.defineProperty(e.prototype,"activeLevel",{get:function(){return Math.min(this._level,this._activeLevel)},set:function(t){if(t<0)throw new RangeError("Invalid level specified.");this._activeLevel!==t&&(this._activeLevel=t,this._hasFocus=!1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasFocus",{get:function(){return this._hasFocus},set:function(t){this._hasFocus=t,this._group.selectionCount=0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"level",{get:function(){return this._level},set:function(t){t<0&&(t=0),this._level=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"svgElement",{get:function(){return this._svgElement},set:function(t){if(!t)throw ReferenceError("The specified element is undefined.");this._svgElement=t,this._svgElement.append("g").attr("class","squares"),this._svgElement.append("polygon").attr("class","boundary boundary"+this.level)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"polygonsGroup",{get:function(){return this._group},enumerable:!0,configurable:!0}),e.prototype.accept=function(t){t.visitSimpleBudgetElement(this)},e}(f);!function(t){t.BALANCED="balanced",t.DEFICIT="deficit",t.SURPLUS="surplus"}(x||(x={}));var O=function(){function t(t,n){void 0===n&&(n=l.MIN_AMOUNT);var i=this;if(this.incomes=[],this.spendings=[],!function(t){return!isNaN(t.year)&&t.incomes.length>0&&t.incomes.every(function(t){return d(t)})&&t.spendings.length>0&&t.spendings.every(function(t){return d(t)})}(t))throw new TypeError("Invalid configuration specified.");if(n<=0)throw new RangeError("The min amount must be greater than 0.");this.minAmount=n,this.year=t.year;var o=function(t,n,o){if(t.children&&t.children.length>0){var r=new w(t.name,t.description||"",n,i.minAmount);t.children.forEach(function(t){return i.initializeBudgetElement(t,n,r)}),o.push(r)}else i.isAcceptableAmount(t.amount)&&o.push(new P(t.amount,t.name,t.description||"",n,i.minAmount));o.sort(function(t,n){return e.descending(t.amount,n.amount)})};t.incomes.forEach(function(t){return o(t,p.INCOME,i.incomes)}),t.spendings.forEach(function(t){return o(t,p.SPENDING,i.spendings)})}return Object.defineProperty(t.prototype,"elements",{get:function(){return this.incomes.concat(this.spendings).sort(function(t,n){return e.descending(t.amount,n.amount)})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"summary",{get:function(){var t=this.incomes.reduce(function(t,e){return t+e.amount+e.temporaryAmount},0),e=this.spendings.reduce(function(t,e){return t+e.amount+e.temporaryAmount},0),n=t-e,i=x.BALANCED;return n<0?i=x.DEFICIT:n>0&&(i=x.SURPLUS),{delta:n,incomesAmount:t,spendingsAmount:e,state:i}},enumerable:!0,configurable:!0}),t.prototype.initializeBudgetElement=function(e,n,i){var o=this;if(e.children&&e.children.length>0){t._amountStack.push(0);var r=new w(e.name,e.description||"",n,this.minAmount);e.children.forEach(function(t){return o.initializeBudgetElement(t,n,r)});var s=t._amountStack[t._amountStack.length-1];i&&(this.isAcceptableAmount(r.amount)&&r.children.length>1?i.addChild(r):this.isAcceptableAmount(s)&&i.addChild(new P(s,e.name,e.description||"",n,this.minAmount))),t._amountStack.pop(),t._amountStack.length>0&&(t._amountStack[t._amountStack.length-1]+=s)}else i&&this.isAcceptableAmount(e.amount)&&(t._amountStack.length>0&&(t._amountStack[t._amountStack.length-1]+=e.amount),i.addChild(new P(e.amount,e.name,e.description||"",n,this.minAmount)))},t.prototype.isAcceptableAmount=function(t){return Math.round(t/this.minAmount)>0},t._amountStack=[],t}();"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function C(t,e){return t(e={exports:{}},e.exports),e.exports}var N=C(function(t,e){var i,o;t.exports=(i=n,o=c,function(){var t=function(){return"n"},e=function(){return[0,0]},n=function(){return" "},r=document.body,s=p(),a=null,u=null,h=null;function c(t){var e;e=t.node(),(a=e?"svg"===e.tagName.toLowerCase()?e:e.ownerSVGElement:null)&&(u=a.createSVGPoint(),r.appendChild(s))}c.show=function(){var i=Array.prototype.slice.call(arguments);i[i.length-1]instanceof SVGElement&&(h=i.pop());var o,s=n.apply(this,i),a=e.apply(this,i),u=t.apply(this,i),p=g(),f=d.length,_=document.documentElement.scrollTop||r.scrollTop,m=document.documentElement.scrollLeft||r.scrollLeft;for(p.html(s).style("opacity",1).style("pointer-events","all");f--;)p.classed(d[f],!1);return o=l.get(u).apply(this),p.classed(u,!0).style("top",o.top+a[0]+_+"px").style("left",o.left+a[1]+m+"px"),c},c.hide=function(){var t=g();return t.style("opacity",0).style("pointer-events","none"),c},c.attr=function(t,e){if(arguments.length<2&&"string"==typeof t)return g().attr(t);var n=Array.prototype.slice.call(arguments);return o.selection.prototype.attr.apply(g(),n),c},c.style=function(t,e){if(arguments.length<2&&"string"==typeof t)return g().style(t);var n=Array.prototype.slice.call(arguments);return o.selection.prototype.style.apply(g(),n),c},c.direction=function(e){return arguments.length?(t=null==e?e:_(e),c):t},c.offset=function(t){return arguments.length?(e=null==t?t:_(t),c):e},c.html=function(t){return arguments.length?(n=null==t?t:_(t),c):n},c.rootElement=function(t){return arguments.length?(r=null==t?t:_(t),c):r},c.destroy=function(){return s&&(g().remove(),s=null),c};var l=i.map({n:function(){var t=f(this);return{top:t.n.y-s.offsetHeight,left:t.n.x-s.offsetWidth/2}},s:function(){var t=f(this);return{top:t.s.y,left:t.s.x-s.offsetWidth/2}},e:function(){var t=f(this);return{top:t.e.y-s.offsetHeight/2,left:t.e.x}},w:function(){var t=f(this);return{top:t.w.y-s.offsetHeight/2,left:t.w.x-s.offsetWidth}},nw:function(){var t=f(this);return{top:t.nw.y-s.offsetHeight,left:t.nw.x-s.offsetWidth}},ne:function(){var t=f(this);return{top:t.ne.y-s.offsetHeight,left:t.ne.x}},sw:function(){var t=f(this);return{top:t.sw.y,left:t.sw.x-s.offsetWidth}},se:function(){var t=f(this);return{top:t.se.y,left:t.se.x}}}),d=l.keys();function p(){var t=o.select(document.createElement("div"));return t.style("position","absolute").style("top",0).style("opacity",0).style("pointer-events","none").style("box-sizing","border-box"),t.node()}function g(){return null==s&&(s=p(),r.appendChild(s)),o.select(s)}function f(t){for(var e=h||t;null==e.getScreenCTM&&null!=e.parentNode;)e=e.parentNode;var n={},i=e.getScreenCTM(),o=e.getBBox(),r=o.width,s=o.height,a=o.x,c=o.y;return u.x=a,u.y=c,n.nw=u.matrixTransform(i),u.x+=r,n.ne=u.matrixTransform(i),u.y+=s,n.se=u.matrixTransform(i),u.x-=r,n.sw=u.matrixTransform(i),u.y-=s/2,n.w=u.matrixTransform(i),u.x+=r,n.e=u.matrixTransform(i),u.x-=r/2,u.y-=s/2,n.n=u.matrixTransform(i),u.y+=s,n.s=u.matrixTransform(i),n}function _(t){return"function"==typeof t?t:function(){return t}}return c})}),G=function(){function t(t,e,n){this._isFirstTime=!0,this._amount=t.temporaryAmount,this._element=t,this._rendering=e,this._layout=n}return t.prototype.execute=function(){this._element.temporaryAmount=0,this._element.amount+=this._amount,this.update()},t.prototype.undo=function(){this._element.amount-=this._amount,this.update()},t.prototype.update=function(){this._element.selectedAmount=0,this._rendering.transitionDuration=0,this._element.accept(this._rendering),this._rendering.resetTransitionDuration(),this._isFirstTime&&(this._element.selectedAmount=this._amount);var t=this._element.root;(this._isFirstTime||t!==this._element)&&t.accept(this._rendering),this._layout.render(),this._isFirstTime=!1},t}(),I=function(){function t(){this._handlers=[]}return t.prototype.register=function(t,e){e||(e=this),this._handlers.push({handler:t,context:e})},t.prototype.unregister=function(t,e){e||(e=this),this._handlers=this._handlers.filter(function(n){return n.handler!==t&&n.context!==e})},t.prototype.invoke=function(t){this._handlers.slice(0).forEach(function(e){return e.handler.call(e.context,t)})},t}();var T,D=function(){function t(){this.onCommandInvoked=new I,this._commands=[],this._currentIndex=-1}return Object.defineProperty(t.prototype,"canUndo",{get:function(){return this._commands.length>=1&&this._currentIndex>=0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canRedo",{get:function(){return this._commands.length>=1&&this._currentIndex<this._commands.length-1},enumerable:!0,configurable:!0}),t.prototype.undo=function(){this.canUndo&&(this._commands[this._currentIndex--].undo(),this.onCommandInvoked.invoke())},t.prototype.redo=function(){this.canRedo&&(this._commands[++this._currentIndex].execute(),this.onCommandInvoked.invoke())},t.prototype.invoke=function(t,e){void 0===e&&(e=!0),e&&function(t){return function(t){return void 0!==t&&void 0!==t.execute}(t)&&void 0!==t.undo}(t)&&(this._commands=this._commands.slice(0,++this._currentIndex),this._commands.push(t)),t.execute(),this.onCommandInvoked.invoke()},t}(),S=function(){function t(t,e,n){this._amount=Math.abs(t.temporaryAmount),this._element=t,this._rendering=e,this._layout=n}return t.prototype.execute=function(){this._element.temporaryAmount=0,this._element.amount-=this._amount,this.update()},t.prototype.undo=function(){this._element.amount+=this._amount,this.update()},t.prototype.update=function(){this._rendering.transitionDuration=0,this._element.accept(this._rendering),this._rendering.resetTransitionDuration();var t=this._element.root;this._element!==t&&t.accept(this._rendering),this._layout.render()},t}(),B=function(){function t(t){this._levelStack=[],this._defaultTransitionDuration=this.transitionDuration=t}return Object.defineProperty(t.prototype,"transitionDuration",{get:function(){return this._transitionDuration},set:function(t){if(t<0)throw new RangeError("The transition duration must be greater or equal to 0.");this._transitionDuration=t},enumerable:!0,configurable:!0}),t.prototype.resetTransitionDuration=function(){this._transitionDuration=this._defaultTransitionDuration},t.prototype.visitBudgetElementGroup=function(e){var n=this;if(0===this._levelStack.length&&e.polygonsGroup.update(),this._levelStack.push(0),e.svgElement.selectAll(".empty").remove(),t.updateBoundary(e),e.children.forEach(function(t,e){t.accept(n),t.svgElement.transition().duration(n._transitionDuration).attr("class",t.level-1===t.activeLevel&&l.IS_USING_DISTINCT_COLORS?"group"+e:"").attr("transform","translate("+t.polygonsGroup.translation.x+", "+t.polygonsGroup.translation.y+")")}),e.activeLevel-e.level==1){var i=this._levelStack[this._levelStack.length-1]>=1?14:7,o=i/2;(r=e.svgElement.select(".level-group")).select("rect").transition().duration(this._transitionDuration).attr("x",-i).attr("y",-o).attr("height",e.polygonsGroup.boundingBox.height+i).attr("width",i),r.select("line").transition().duration(this._transitionDuration).attr("x1",-i).attr("y1",-o).attr("x2",-i).attr("y2",e.polygonsGroup.boundingBox.height+o),this._levelStack[this._levelStack.length-1]=1}else{var r;(r=e.svgElement.select(".level-group")).select("rect").transition().duration(this._transitionDuration).attr("x",0).attr("y",0).attr("height",0).attr("width",0),r.select("line").transition().duration(this._transitionDuration).attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",0)}e.isActive&&0===e.amount&&t.createEmptyElement(e);var s=this._levelStack.pop();this._levelStack.length>=1&&(this._levelStack[this._levelStack.length-1]+=s)},t.prototype.visitSimpleBudgetElement=function(e){var n=e.svgElement.select(".squares").selectAll(".square").data(e.polygonsGroup.polygons,function(t){return t.id});t.updateBoundary(e),n.enter().append("polygon").on("animationend",function(){e.hasFocus||(this.classList.remove("selected"),e.selectedAmount=0)}).merge(n).attr("class","square "+e.type).classed("focused",e.hasFocus).classed("selected",function(t){return t.isSelected}).classed("temporary",function(t){return t.isTemporary}).classed("added",function(t){return t.isTemporary&&e.temporaryAmount>0}).classed("removed",function(t){return t.isTemporary&&e.temporaryAmount<0}).transition().duration(this._transitionDuration).attr("points",function(t){return t.points.map(function(t){return t.x+" "+t.y}).join(", ")}),n.exit().remove(),e.isActive&&0===e.amount&&t.createEmptyElement(e)},t.createEmptyElement=function(t){var e=t.polygonsGroup.config.sideLength;t.svgElement.append("rect").attr("class","square empty").attr("x",0).attr("y",0).attr("width",e).attr("height",e)},t.updateBoundary=function(t){t.svgElement.select(".boundary"+t.level).attr("points",t.level-1<=t.activeLevel?t.polygonsGroup.boundary.map(function(t){return t.x+" "+t.y}).join(", "):"")},t}(),M=function(){function t(t,e,n,i,o){void 0===i&&(i=new D),void 0===o&&(o=new B(l.TRANSITION_DURATION)),this._isInitialized=!1,this._budget=t,this._svgElement=e,this._layout=n,this._commandInvoker=i,this._rendering=o}return Object.defineProperty(t.prototype,"budget",{get:function(){return this._budget},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activeLevel",{set:function(t){var e=this;this._budget.elements.forEach(function(n){n.activeLevel=t,n.accept(e._rendering)}),this._layout.render()},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var t=this;if(this._isInitialized)throw new Error("The visualization is already initialized.");var e=this,n=void 0,o=void 0;this._svgElement.attr("class","budget-visualization"),this._layout.initialize();var r=N().html(function(t){var e="<strong>"+t.name+" ("+g.formatAmount(t.amount+t.temporaryAmount)+")</strong>";return e+=t.description?"<p>"+t.description+"</p>":""});this._svgElement.call(r);var s=function(){void 0!==o&&0!==o.temporaryAmount&&(o.temporaryAmount>0?t._commandInvoker.invoke(new G(o,t._rendering,t._layout)):t._commandInvoker.invoke(new S(o,t._rendering,t._layout)))};i.select("body").on("wheel",function(){if(o){var e=i.event.deltaY;o.temporaryAmount+=e/100*t._budget.minAmount,t._rendering.transitionDuration=0,o.root.accept(t._rendering),t._rendering.resetTransitionDuration(),t._layout.render()}}).on("keydown",function(){if(o){var e=!1;switch(i.event.key){case"ArrowUp":e=!0,o.temporaryAmount-=t._budget.minAmount;break;case"ArrowDown":e=!0,o.temporaryAmount+=t._budget.minAmount}if(!e)return;t._rendering.transitionDuration=0,o.root.accept(t._rendering),t._rendering.resetTransitionDuration(),t._layout.render()}}).on("click",function(){o&&o.hasFocus&&(o.hasFocus=!1,o.accept(t._rendering)),s(),o=void 0});var a=new(function(){function t(){}return t.prototype.visitBudgetElementGroup=function(t){var o=this;this.subscribe(t),t.svgElement.select(".level-group").on("mouseenter",function(){n=t,r.direction("w").offset([0,-8]).attr("class","d3-tip level-tip").show.call(t.svgElement.node(),t)}).on("mouseleave",function(){n=void 0,r.hide()}).on("click",function(){i.event.stopPropagation(),s(),r.hide(),t.activeLevel=t.level,t.root.accept(e._rendering),e._layout.render()}),t.children.forEach(function(t){return t.accept(o)})},t.prototype.visitSimpleBudgetElement=function(t){this.subscribe(t)},t.prototype.subscribe=function(t){if(!t.svgElement)throw new TypeError("The SVG element is undefined.");function a(){t.level>0&&r.direction("e").offset([0,8]).attr("class","d3-tip element-tip").show.call(t.svgElement.node(),t)}t.svgElement.on("click",function(){t.isActive&&(i.event.stopPropagation(),o&&o!==t&&o.hasFocus&&(o.hasFocus=!1,o.accept(e._rendering),s()),o=t,t.hasFocus=!0,t.accept(e._rendering))}),t.svgElement.on("mouseenter",function(){t.isActive&&((n=t).svgElement.classed("hovered",!0),a())}),t.svgElement.on("mouseover",function(){t.isActive&&((n=t).svgElement.classed("hovered",!0),a())}),t.svgElement.on("mouseleave",function(){t.isActive&&n&&(n.svgElement.classed("hovered",!1),n=void 0,r.hide())}),t.svgElement.on("dblclick",function(){t.isActive&&(s(),o=void 0,t.activeLevel+=1,t.root.accept(e._rendering),e._layout.render(),n.svgElement.classed("hovered",!1),n=void 0,r.hide())})},t}());this._budget.elements.forEach(function(e){e.accept(a),e.accept(t._rendering)}),this._layout.render(),this._isInitialized=!0},t.prototype.reset=function(){},t.prototype.update=function(t,e){var n=this;if(!this._isInitialized)throw new Error("The visualization is not initialized. Please initialize the visualization first.");if(e){var i=new(function(){function t(){}return t.prototype.visitBudgetElementGroup=function(t){var n=this;t.polygonsGroup.config=e,t.children.forEach(function(t){return t.accept(n)})},t.prototype.visitSimpleBudgetElement=function(t){t.polygonsGroup.config=e},t}());this._budget.elements.forEach(function(t){t.accept(i),t.accept(n._rendering)})}this._layout=t,this._layout.initialize(),this._layout.render()},t}(),R=C(function(t,e){!function(t,e,n,i,o,r){function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleGauge=void 0;var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u={BAR_WIDTH:40,CHAR_INSET:10,EASE_TYPE:n.easeElastic,NEEDLE_ANIMATION_DELAY:0,NEEDLE_ANIMATION_DURATION:3e3,NEEDLE_RADIUS:15,PAD_RAD:.05},h=function(t){return function(t){return 360*t}(t)*Math.PI/180},c=function(){function t(e){s(this,t),this._animationDelay=e.animationDelay,this._animationDuration=e.animationDuration,this._color=e.color,this._easeType=e.easeType,this._el=e.el,this._length=e.length,this._percent=e.percent,this._radius=e.radius,this._initialize()}return a(t,[{key:"update",value:function(t){var e=this;this._el.transition().delay(this._animationDelay).ease(this._easeType).duration(this._animationDuration).selectAll(".needle").tween("progress",function(){var n=this,i=t-e._percent,o=e._percent;return function(t){return e._percent=o+t*i,(0,r.select)(n).attr("d",e._getPath(e._percent))}})}},{key:"_initialize",value:function(){this._el.append("circle").attr("class","needle-center").attr("cx",0).attr("cy",0).attr("r",this._radius),this._el.append("path").attr("class","needle").attr("d",this._getPath(this._percent)),this._color&&(this._el.select(".needle-center").style("fill",this._color),this._el.select(".needle").style("fill",this._color))}},{key:"_getPath",value:function(t){var e=Math.PI/2,n=h(t/2),i=0-this._length*Math.cos(n),o=0-this._length*Math.sin(n),r=0-this._radius*Math.cos(n-e),s=0-this._radius*Math.sin(n-e),a=0-this._radius*Math.cos(n+e),u=0-this._radius*Math.sin(n+e);return"M "+r+" "+s+" L "+i+" "+o+" L "+a+" "+u}}]),t}();t.SimpleGauge=function(){function t(e){if(s(this,t),!e.el)throw new Error("The element must be valid.");if(isNaN(e.height)||e.height<=0)throw new RangeError("The height must be a positive number.");if(isNaN(e.sectionsCount)||e.sectionsCount<=0)throw new RangeError("The sections count must be a positive number.");if(isNaN(e.width)||e.width<=0)throw new RangeError("The width must be a positive number.");if(void 0!==e.animationDelay&&(isNaN(e.animationDelay)||e.animationDelay<0))throw new RangeError("The transition delay must be greater or equal to 0.");if(void 0!==e.animationDuration&&(isNaN(e.animationDuration)||e.animationDuration<0))throw new RangeError("The transition duration must be greater or equal to 0.");if(void 0!==e.barWidth&&(isNaN(e.barWidth)||e.barWidth<=0))throw new RangeError("The bar width must be a positive number.");if(void 0!==e.chartInset&&(isNaN(e.chartInset)||e.chartInset<0))throw new RangeError("The chart inset must be greater or equal to 0.");if(void 0!==e.needleRadius&&(isNaN(e.needleRadius)||e.needleRadius<0))throw new RangeError("The needle radius must be greater or equal to 0.");if(void 0!==e.sectionsColors&&e.sectionsColors.length!==e.sectionsCount)throw new RangeError("The sectionsColors length must match with the sectionsCount.");this._animationDelay=void 0!==e.animationDelay?e.animationDelay:u.NEEDLE_ANIMATION_DELAY,this._animationDuration=void 0!==e.animationDuration?e.animationDuration:u.NEEDLE_ANIMATION_DURATION,this._chartInset=void 0!==e.chartInset?e.chartInset:u.CHAR_INSET,this._barWidth=e.barWidth||u.BAR_WIDTH,this._easeType=e.easeType||u.EASE_TYPE,this._el=e.el,this._height=e.height,this._needleRadius=void 0!==e.needleRadius?e.needleRadius:u.NEEDLE_RADIUS,this._sectionsCount=e.sectionsCount,this._width=e.width,this._sectionsColors=e.sectionsColors,this._needleColor=e.needleColor,this.interval=e.interval||[0,1],this.percent=void 0!==e.percent?e.percent:0,this._initialize()}return a(t,[{key:"_initialize",value:function(){var t=this,n=1/this._sectionsCount/2,o=u.PAD_RAD,r=.75,s=Math.min(this._width,2*this._height)/2;this._chart=this._el.append("g").attr("transform","translate("+this._width/2+", "+this._height+")"),this._arcs=this._chart.selectAll(".arc").data((0,i.range)(1,this._sectionsCount+1)).enter().append("path").attr("class",function(t){return"arc chart-color"+t}).attr("d",function(i){var a=h(r),u=a+h(n);r+=n;var c=0===i?0:o/2,l=i===t._sectionsCount?0:o/2,d=(0,e.arc)().outerRadius(s-t._chartInset).innerRadius(s-t._chartInset-t._barWidth).startAngle(a+c).endAngle(u-l);return d(t)}),this._sectionsColors&&this._arcs.style("fill",function(e){return t._sectionsColors[e-1]}),this._needle=new c({animationDelay:this._animationDelay,animationDuration:this._animationDuration,color:this._needleColor,easeType:this._easeType,el:this._chart,length:.5*this._height,percent:this._percent,radius:this._needleRadius}),this._update()}},{key:"_update",value:function(){var t=this;this._arcs&&(this._arcs.classed("active",function(e,n){return n===Math.floor(t._percent*t._sectionsCount)||n===t._arcs.size()-1&&1===t._percent}),this._chart.classed("min",0===this._percent),this._chart.classed("max",1===this._percent))}},{key:"interval",get:function(){return this._scale.domain()},set:function(t){if(!(t instanceof Array)||2!==t.length||isNaN(t[0])||isNaN(t[1])||t[0]>t[1])throw new Error("The interval specified is invalid.");this._scale=(0,o.scaleLinear)().domain(t).range([0,1]).clamp(!0)}},{key:"percent",get:function(){return this._percent},set:function(t){if(isNaN(t)||t<0||t>1)throw new RangeError("The percentage must be between 0 and 1.");this._needle&&this._needle.update(t),this._percent=t,this._update()}},{key:"value",set:function(t){if(isNaN(t))throw new Error("The specified value must be a number.");this.percent=this._scale(t)}}]),t}()}(e,r,s,u,a,c)}),z=(T=R)&&T.__esModule&&Object.prototype.hasOwnProperty.call(T,"default")?T.default:T,k=function(){function t(t,e){this._budget=t,this._svgElement=e;var n=this._svgElement.node();this._width=n.clientWidth,this._height=n.clientHeight}return t.prototype.initialize=function(){var t=this;function e(t){var e=i.select(this),n=e.append("g").attr("class","text-group");n.append("text").attr("class","element-amount").text(g.formatAmount(t.amount)),n.append("text").attr("class","element-name"),t.svgElement=e.append("g").attr("class","polygons-group")}this._svgElement.attr("viewBox","0 0 "+this._width+" "+this._height),this._layout=this._svgElement.select("#layout"),this._layout.size()||(this._layout=this._svgElement.append("g").attr("id","layout")),this._layout.select(".separator").size()<=0&&this._layout.append("line").attr("class","separator"),this._gaugeGroup=this._layout.select("#budget-gauge-group"),this._gaugeGroup.size()<=0&&(this._gaugeGroup=this._layout.append("g").attr("id","budget-gauge-group").attr("class","budget-gauge-group"),this._gaugeGroup.append("rect").attr("width",l.GAUGE_CONFIG.width).attr("height",l.GAUGE_CONFIG.height+45).attr("fill","#fff"),this._gaugeGroup.append("text").attr("text-anchor","middle").attr("x",l.GAUGE_CONFIG.width/2).attr("y",95),this._gaugeGroup.datum(new z.SimpleGauge({barWidth:l.GAUGE_CONFIG.barWidth,el:this._gaugeGroup.append("g"),height:l.GAUGE_CONFIG.height,interval:l.GAUGE_CONFIG.interval,needleRadius:l.GAUGE_CONFIG.needleRadius,sectionsCount:2,width:l.GAUGE_CONFIG.width}))),this._layout.select("#budget-group")&&(this._budgetGroup=this._layout.append("svg").attr("id","budget-group").attr("height",this._height-l.GAUGE_CONFIG.height)),this._budgetGroup.attr("viewBox","0 0 "+this._width+" "+this._height);var n=function(n,i){var o=t._budgetGroup.select("#"+i);o.size()||(o=t._budgetGroup.append("g").attr("id",i));var r=o.selectAll("g").data(n,function(t){return t.id}),s=r.enter().append("g").each(e);return r.merge(s)};this._incomeGroups=n(this._budget.incomes,"incomes-group"),this._spendingGroups=n(this._budget.spendings,"spendings-group"),this.initializeLayout()},t.prototype.render=function(){function t(t){i.select(this).select(".element-amount").text(g.formatAmount(t.amount+t.temporaryAmount))}this._incomeGroups=this._incomeGroups.sort(function(t,n){return e.descending(t.amount,n.amount)}).each(t),this._spendingGroups=this._spendingGroups.sort(function(t,n){return e.descending(t.amount,n.amount)}).each(t);var n=this._budget.summary.delta;this._gaugeGroup.datum().value=n,this._layout.select("#budget-gauge-group").select("text").text(g.formatAmount(n)),this.renderLayout()},t}();function j(t){return!isNaN(t.averageCharSize)&&t.averageCharSize>0&&!isNaN(t.horizontalMinSpacing)&&t.horizontalMinSpacing>=0&&!isNaN(t.horizontalPadding)&&t.horizontalPadding>=0&&!isNaN(t.polygonLength)&&t.polygonLength>0&&!isNaN(t.transitionDuration)&&t.transitionDuration>=0&&!isNaN(t.verticalMinSpacing)&&t.verticalMinSpacing>=0&&!isNaN(t.verticalPadding)&&t.verticalPadding>=0}var U=function(t){function e(e,n,i){var o=t.call(this,e,n)||this;if(!j(i))throw new TypeError("Invalid configuration specified.");return o._config=i,o}return m(e,t),e.prototype.initializeLayout=function(){var t=this,e=0;function n(n){var o=i.select(this),r=n.name,s=r.indexOf(",");-1!==s&&(r=r.substring(0,s));var a=r.split(" "),u="",h=[];a.forEach(function(e){u.length*t._config.averageCharSize<t._config.polygonLength?u+=0===u.length?e:" "+e:(h.push(u),u=e)}),h.push(u);var c=o.select(".text-group").attr("transform","");c.select(".amount").attr("text-anchor","middle").attr("x",t._config.polygonLength/2).attr("y",0);var l=c.select(".label").attr("text-anchor","middle").attr("y",5).selectAll("tspan").data(h);l.exit().remove();var d=l.enter().append("tspan");l.merge(d).attr("x",t._config.polygonLength/2).attr("dy",11).text(function(t){return t});var p=c.node().getBBox().height;e<p&&(e=p)}function o(){i.select(this).select(".polygons-group").attr("transform","translate(0, "+e+")")}this._incomeGroups.each(n).each(o),this._spendingGroups.each(n).each(o);var r=Math.max(this._budget.incomes.length,this._budget.spendings.length),s=2*this._config.horizontalPadding+r*this._config.polygonLength+(r-1)*this._config.horizontalMinSpacing,a=this._budget.elements[0],u=Math.ceil(a.polygonsGroup.count/a.polygonsGroup.config.maxCountPerLine)*a.polygonsGroup.config.sideLength,h=2*(2*this._config.verticalPadding+u+e);this._width=Math.max(s,this._width),this._height=Math.max(h,this._height),this._svgElement.attr("viewBox","0 0 "+this._width+" "+this._height);var c=this._height/2;this._layout.select(".separator").attr("x1",0).attr("y1",c).attr("x2",this._width).attr("y2",c),this._gaugeGroup.attr("transform","translate("+(this._width/2-l.GAUGE_CONFIG.width/2)+", "+(this._height-110)+")"),this._layout.select("#incomes-group").attr("transform","translate(0, 0)"),this._layout.select("#spendings-group").attr("transform","translate(0, "+c+")")},e.prototype.renderLayout=function(){var t,e=this;function n(n,i){return 0===i?t=e._config.horizontalPadding:t+=e._config.polygonLength+e._config.horizontalMinSpacing,"translate("+t+", "+e._config.verticalPadding+")"}this._incomeGroups.transition().duration(this._config.transitionDuration).attr("transform",n),this._spendingGroups.transition().duration(this._config.transitionDuration).attr("transform",n)},e}(k),F=function(t){function n(e,n,i){var o=t.call(this,e,n)||this;if(!j(i))throw new TypeError("Invalid configuration specified.");return o._config=i,o}return m(n,t),n.prototype.initializeLayout=function(){var t=this,e=this._width/2;function n(e){var n=i.select(this),o=e.name,r=o.indexOf(",");-1!==r&&(o=o.substring(0,r));var s=o.split(" "),a="",u=[];s.forEach(function(e){a.length*t._config.averageCharSize<t._config.polygonLength?a+=0===a.length?e:" "+e:(u.push(a),a=e)}),u.push(a);var h=n.select(".text-group").attr("transform","");h.select(".element-amount").attr("text-anchor","middle").attr("x",t._config.polygonLength/2).attr("y",0);var c=h.select(".element-name").attr("text-anchor","middle").attr("y",5).selectAll("tspan").data(u);c.exit().remove();var l=c.enter().append("tspan");c.merge(l).attr("x",t._config.polygonLength/2).attr("dy",11).text(function(t){return t})}this._layout.select(".separator").attr("x1",e).attr("y1",0).attr("x2",e).attr("y2",this._height),this._gaugeGroup.attr("transform","translate("+(this._width/2-l.GAUGE_CONFIG.width/2)+", "+(this._height-110)+")"),this._layout.select("#incomes-group").attr("transform","translate(0, 0)"),this._layout.select("#spendings-group").attr("transform","translate("+this._width/2+", 0)"),this._incomeGroups.each(n),this._spendingGroups.each(n)},n.prototype.renderLayout=function(){var t=this,n=this,o=this._width/2,r=Math.floor((o-2*this._config.horizontalPadding)/(this._config.polygonLength+this._config.horizontalMinSpacing)),s=(o-2*this._config.horizontalPadding-r*this._config.polygonLength)/(r-1),a=[];function u(t,e){var n=i.select(this).select(".text-group");0===e&&(a=[]),e%r==0&&a.push(0);var o=Math.floor(e/r),s=n.node().getBBox().height;a[o]<s&&(a[o]=s)}var h,c,l,d=[];function p(t,e){0===e&&(d=[],c=n._config.verticalPadding,l=0),e%r==0?(d.push(0),h=n._config.horizontalPadding,0!==e&&(c+=l+n._config.verticalMinSpacing),l=0):h+=n._config.polygonLength+s;var o=a[Math.floor(e/r)];return i.select(this).select(".polygons-group").attr("transform","translate(0, "+o+")"),t.polygonsGroup.boundingBox.height>l&&(l=t.polygonsGroup.boundingBox.height+o,d[Math.floor(e/r)]=l),"translate("+h+", "+c+")"}this._incomeGroups.each(u).transition().duration(this._config.transitionDuration).attr("transform",p),this._spendingGroups.each(u).transition().duration(this._config.transitionDuration).attr("transform",p),this._budgetGroup.transition().duration(this._config.transitionDuration).attr("viewBox",function(){var i=e.sum(d)+2*n._config.verticalPadding+(d.length-1)*n._config.verticalMinSpacing+100;t._height;return"0 0 "+t._width+" "+i})},n}(k),q=function(t){function n(e,n,i){var o=t.call(this,e,n)||this;if(!j(i))throw new TypeError("Invalid configuration specified.");return o._config=i,o}return m(n,t),n.prototype.initializeLayout=function(){var t=this,n=e.max(this._budget.elements,function(t){return t.name.length}),o=0;function r(e){var r=i.select(this),s=e.name,a=s.indexOf(",");-1!==a&&(s=s.substring(0,a));var u=s.split(" "),h="",c=[];u.forEach(function(e){h.length*t._config.averageCharSize<n*t._config.averageCharSize/4?h+=0===h.length?e:" "+e:(c.push(h),h=e)}),c.push(h);var l=r.select(".text-group");l.select(".amount").attr("text-anchor","end").attr("x",0).attr("y",7);var d=l.select(".label").attr("text-anchor","end").attr("y",10).selectAll("tspan").data(c);d.exit().remove();var p=d.enter().append("tspan");d.merge(p).attr("x",0).attr("dy",11).text(function(t){return t}),r.select(".polygons-group").attr("transform","");var g=l.node().getBBox().width;o<g&&(o=g)}function s(){var e=i.select(this);e.select(".text-group").attr("transform","translate("+o+", 0)"),e.select(".polygons-group").attr("transform","translate("+(o+t._config.horizontalPadding)+", 0)")}this._incomeGroups.each(r).each(s),this._spendingGroups.each(r).each(s);var a=Math.max(this._budget.incomes.length,this._budget.spendings.length),u=2*this._config.verticalPadding+a*this._config.polygonLength+(a-1)*this._config.verticalMinSpacing,h=this._budget.elements[0],c=Math.ceil(h.polygonsGroup.count/h.polygonsGroup.config.maxCountPerLine)*h.polygonsGroup.config.sideLength,d=2*(2*this._config.horizontalPadding+c+o+t._config.horizontalPadding);this._width=Math.max(d,this._width),this._height=Math.max(u,this._height),this._svgElement.attr("viewBox","0 0 "+this._width+" "+this._height);var p=this._width/2;this._layout.select(".separator").attr("x1",p).attr("y1",0).attr("x2",p).attr("y2",this._height),this._gaugeGroup.attr("transform","translate("+(this._width/2-l.GAUGE_CONFIG.width/2)+", "+(this._height-110)+")"),this._layout.select("#incomes-group").attr("transform","translate("+p+", 0)"),this._layout.select("#spendings-group").attr("transform","translate(0, 0)")},n.prototype.renderLayout=function(){var t,e=this;function n(n,i){return 0===i?t=e._config.verticalPadding:t+=e._config.polygonLength+e._config.verticalMinSpacing,"translate("+e._config.horizontalPadding+", "+t+")"}this._incomeGroups.transition().duration(this._config.transitionDuration).attr("transform",n),this._spendingGroups.transition().duration(this._config.transitionDuration).attr("transform",n)},n}(k);t.Budget=O,t.BudgetVisualization=M,t.CommandInvoker=D,t.BarsLayout=U,t.GridLayout=F,t.HorizontalBarsLayout=q,t.Config=l,Object.defineProperty(t,"__esModule",{value:!0})});
